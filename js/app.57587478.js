(function(e){function t(t){for(var r,a,s=t[0],c=t[1],u=t[2],l=0,d=[];l<s.length;l++)a=s[l],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&d.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);p&&p(t);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={app:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/libp2p-cam-stream/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var p=c;i.push([1,"chunk-vendors"]),n()})({0:function(e,t){},"034f":function(e,t,n){"use strict";var r=n("85ec"),o=n.n(r);o.a},"0498":function(e,t,n){"use strict";var r=n("5aae"),o=n.n(r);o.a},1:function(e,t,n){e.exports=n("56d7")},2:function(e,t){},3:function(e,t){},4:function(e,t){},"4a7c":function(e,t,n){"use strict";var r=n("c4ad"),o=n.n(r);o.a},5:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Home")],1)},i=[],a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"ipfs-info"},[r("img",{staticClass:"ipfs-logo",attrs:{alt:"IPFS logo",src:n("9b19")}}),r("div",{staticClass:"peer-id"},[e._v(" "+e._s(e.id)+" "),e.isRecording?e._e():r("button",{on:{click:e.startRecord}},[e._v("Start Recording")]),e.isRecording?r("button",{on:{click:e.stopRecord}},[e._v("Stop Recording")]):e._e()]),r("div",{staticClass:"videos-container"},e._l(Object.keys(e.peers),(function(t,n){return r("video-holder",{key:n,attrs:{blobs:e.peers[t].blobs}})})),1)])},s=[],c=(n("7db0"),n("4160"),n("d3b7"),n("25f0"),n("3ca3"),n("159b"),n("ddb0"),n("2b3d"),n("96cf"),n("1da1")),u=n("668b"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.blob?n("div",{staticClass:"video-holder"},[n("div",{staticClass:"dots"},e._l(e.blobs,(function(t,r){return n("div",{key:r,class:{dot:!0,disabled:r>e.current}})})),0),n("video",{ref:"video",attrs:{src:e.blob,autoplay:"",playsinline:""},on:{ended:function(t){return e.nextVideo()}}})]):e._e()},l=[],d={name:"video-holder",props:{blobs:Array},data:function(){return{playing:!1,blob:void 0,current:-1}},watch:{blobs:function(e){this.playing||(this.nextVideo(),this.$refs.video.paused&&this.$refs.video.play()),this.playing=!0}},methods:{nextVideo:function(){0!==this.blobs.length&&(this.current=(this.current+1)%this.blobs.length,this.blob=this.blobs[this.current])}}},f=d,b=(n("0498"),n("2877")),v=Object(b["a"])(f,p,l,!1,null,"a446eb9e",null),h=v.exports,g=n("66f2"),m=(n("eddf"),{name:"home",components:{videoHolder:h},data:function(){return{id:"",peer:"",camera:void 0,recorder:void 0,isRecording:!1,peers:[],interval:void 0,libp2p:{}}},mounted:function(){this.startPubsub()},methods:{startPubsub:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$startLibp2p();case 2:e.libp2p=t.sent,window.libp2p=e.libp2p,e.id=e.libp2p.peerId.toB58String(),e.libp2p.pubsub.subscribe("hiveriot",function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=e.peers.find((function(e){return e.id===n.from})),r||(r={id:n.from,blobs:[]},e.peers.push(r)),r.blobs.push(window.URL.createObjectURL(new Blob([n.data])));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.libp2p.handle("/protocool",(function(t){var n=t.stream;g(n,function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){var r,o,i,a,s,c,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=!0,o=!1,t.prev=2,a=Object(u["a"])(n);case 4:return t.next=6,a.next();case 6:return s=t.sent,r=s.done,t.next=10,s.value;case 10:if(c=t.sent,r){t.next=17;break}p=c,e.messages.push(p.toString());case 14:r=!0,t.next=4;break;case 17:t.next=23;break;case 19:t.prev=19,t.t0=t["catch"](2),o=!0,i=t.t0;case 23:if(t.prev=23,t.prev=24,r||null==a.return){t.next=28;break}return t.next=28,a.return();case 28:if(t.prev=28,!o){t.next=31;break}throw i;case 31:return t.finish(28);case 32:return t.finish(23);case 33:case"end":return t.stop()}}),t,null,[[2,19,23,33],[24,,28,32]])})));return function(e){return t.apply(this,arguments)}}())}));case 7:case"end":return t.stop()}}),t)})))()},sendMessage:function(e){this.peer?(console.log("enviando... ",this.peer),this.sendDirectMessage(this.peer)):this.libp2p.pubsub.publish("hiveriot",e)},startRecord:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 2:e.camera=t.sent,e.recorder||(e.recorder=new MediaRecorder(e.camera)),e.recorder.start(1e10),e.interval=setInterval((function(){e.restartRecording()}),3e3),e.isRecording=!0,e.recorder.ondataavailable=function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isRecording&&e.recorder.start(1e10),t.t0=e,t.next=4,n.data.arrayBuffer();case 4:t.t1=t.sent,t.t0.sendMessage.call(t.t0,t.t1);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();case 8:case"end":return t.stop()}}),t)})))()},stopRecord:function(){this.isRecording=!1,clearInterval(this.interval),this.recorder.stop(),this.camera.getTracks().forEach((function(e){e.stop()}))},restartRecording:function(){this.recorder.stop()}}}),w=m,x=(n("4a7c"),Object(b["a"])(w,a,s,!1,null,"7cbfe7da",null)),y=x.exports,R={name:"app",components:{Home:y}},O=R,j=(n("034f"),Object(b["a"])(O,o,i,!1,null,null,null)),_=j.exports,k=n("3591"),S=n("6101"),M=n("b04a"),P=n("d6e3"),$=n("2b27"),C=n("2f0b"),B=(n("e06e"),{install:function(e){e.prototype.$startLibp2p=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k.create({addresses:{listen:["/dns4/wrtc-star1.par.dwebops.pub/tcp/443/wss/p2p-webrtc-star","/dns4/wrtc-star2.sjc.dwebops.pub/tcp/443/wss/p2p-webrtc-star"]},modules:{transport:[S,M],streamMuxer:[P],connEncryption:[$],pubsub:C},config:{pubsub:{enabled:!0,emitSelf:!0}}});case 2:return t=e.sent,t.on("peer:discovery",(function(e){console.log("Found peer ".concat(e.toB58String()))})),t.connectionManager.on("peer:connect",(function(e){console.log("Connected to ".concat(e.remotePeer))})),t.connectionManager.on("peer:disconnect",(function(e){console.log("Disconnected from ".concat(e.remotePeer.toB58String()))})),e.next=8,t.start();case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})))}}),E=B;r["a"].use(E),r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(_)}}).$mount("#app")},"5aae":function(e,t,n){},6:function(e,t){},7:function(e,t){},8:function(e,t){},"85ec":function(e,t,n){},"9b19":function(e,t,n){e.exports=n.p+"img/logo.e7599486.svg"},c4ad:function(e,t,n){}});
//# sourceMappingURL=app.57587478.js.map